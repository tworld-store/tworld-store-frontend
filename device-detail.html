<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <base href="/tworld-store-frontend/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ê¸° ìƒì„¸ - SKT ê³µì‹ ì˜¨ë¼ì¸ìƒµ</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-text">í‹°ì›”ë“œìŠ¤í† ì–´</span>
                </a>
                <nav class="main-nav">
                    <a href="devices.html?brand=samsung">ì‚¼ì„±</a>
                    <a href="devices.html?brand=apple">ì• í”Œ</a>
                    <a href="devices.html">ì „ì²´ê¸°ê¸°</a>
                    <a href="plans.html">ìš”ê¸ˆì œ</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="detail-page">
        <div class="container">
            <!-- ìƒë‹¨ ì„¹ì…˜: ê°¤ëŸ¬ë¦¬ + ì˜µì…˜ -->
            <div class="detail-container" id="detail-container">
                <!-- ì¢Œì¸¡: ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ (60%) -->
                <div class="gallery-section">
                    <!-- í° ì´ë¯¸ì§€ -->
                    <div class="main-image-wrapper">
                        <img id="main-image" src="" alt="ê¸°ê¸° ì´ë¯¸ì§€" class="main-image">
                    </div>
                    
                    <!-- ì¸ë„¤ì¼ ê·¸ë¦¬ë“œ (2x2) -->
                    <div class="thumbnail-grid" id="thumbnail-grid">
                        <!-- JSë¡œ ë™ì  ìƒì„± -->
                    </div>
                </div>

                <!-- ìš°ì¸¡: ì˜µì…˜ ë° ê°€ê²© (40%) -->
                <div class="options-section">
                    <!-- ëª¨ë¸ëª… -->
                    <h1 class="device-name" id="device-name">ë¡œë”© ì¤‘...</h1>
                    
                    <!-- ìƒ‰ìƒ ì„ íƒ -->
                    <div class="option-group">
                        <label class="option-label">ìƒ‰ìƒ</label>
                        <div class="color-options" id="color-options">
                            <!-- JSë¡œ ë™ì  ìƒì„± -->
                        </div>
                    </div>

                    <!-- ìš©ëŸ‰ ì„ íƒ -->
                    <div class="option-group">
                        <label class="option-label">ìš©ëŸ‰</label>
                        <div class="capacity-options" id="capacity-options">
                            <!-- JSë¡œ ë™ì  ìƒì„± -->
                        </div>
                    </div>

                    <!-- ê°€ì…ìœ í˜• ì„ íƒ -->
                    <div class="option-group">
                        <label class="option-label">ê°€ì…ìœ í˜•</label>
                        <select id="join-type-select" class="option-select">
                            <option value="ê¸°ê¸°ë³€ê²½">ê¸°ê¸°ë³€ê²½</option>
                            <option value="ë²ˆí˜¸ì´ë™">ë²ˆí˜¸ì´ë™</option>
                            <option value="ì‹ ê·œê°€ì…">ì‹ ê·œê°€ì…</option>
                        </select>
                    </div>

                    <!-- ìš”ê¸ˆì œ ì„ íƒ -->
                    <div class="option-group">
                        <label class="option-label">ìš”ê¸ˆì œ</label>
                        <button type="button" class="option-select-btn" onclick="plansModal.open()">
                            <span id="selected-plan-display">ìš”ê¸ˆì œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                        <!-- ì„ íƒëœ ìš”ê¸ˆì œ ì •ë³´ (ìˆ¨ê¹€ ìƒíƒœë¡œ ì‹œì‘) -->
                        <div id="selected-plan-info" class="hidden mt-2 p-3 bg-blue-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span id="selected-plan-name" class="font-bold text-gray-900"></span>
                                <span id="selected-plan-price" class="text-blue-600 font-bold"></span>
                            </div>
                        </div>
                    </div>

                    <!-- í• ì¸ ë°©ë²• -->
                    <div class="option-group">
                        <label class="option-label">í• ì¸ ë°©ë²•</label>
                        <div class="discount-options">
                            <label class="radio-option">
                                <input type="radio" name="discount-type" value="subsidy" checked>
                                <span>ì§€ì›ê¸ˆì•½ì •</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="discount-type" value="select">
                                <span>ì„ íƒì•½ì •</span>
                            </label>
                        </div>
                    </div>

                    <!-- ì¸í„°ë„·+TV ê²°í•© -->
                    <div class="option-group">
                        <label class="option-label">ì¸í„°ë„·+TV</label>
                        <div class="bundle-options">
                            <label class="radio-option">
                                <input type="radio" name="internet-tv" value="none" checked>
                                <span>ì‹ ì²­ ì•ˆí•¨</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="internet-tv" value="apply">
                                <span>ìƒë‹´ì‹ ì²­</span>
                            </label>
                        </div>
                    </div>

                    <!-- í• ë¶€ ê°œì›” -->
                    <div class="option-group">
                        <label class="option-label">í• ë¶€ ê°œì›”</label>
                        <div class="installment-options">
                            <label class="radio-option">
                                <input type="radio" name="installment" value="0">
                                <span>ì¼ì‹œë¶ˆ</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="installment" value="12">
                                <span>12ê°œì›”</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="installment" value="24" checked>
                                <span>24ê°œì›”</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="installment" value="36">
                                <span>36ê°œì›”</span>
                            </label>
                        </div>
                    </div>

                    <!-- ê°€ê²© ì •ë³´ (9ê°œ í•­ëª©) -->
                    <div class="price-summary">
                        <h3 class="price-section-title">ì›” íœ´ëŒ€í° ìš”ê¸ˆ</h3>
                        <div class="price-detail-row">
                            <span>ì¶œê³ ê°€</span>
                            <span id="release-price">-</span>
                        </div>
                        <div class="price-detail-row discount">
                            <span>íœ´ëŒ€í° í• ì¸ê¸ˆ</span>
                            <span id="phone-discount">-</span>
                        </div>
                        <div class="price-detail-row">
                            <span>í• ë¶€ì›ê¸ˆ</span>
                            <span id="installment-principal">-</span>
                        </div>
                        <div class="price-result-row">
                            <span>ì›” íœ´ëŒ€í° ìš”ê¸ˆ</span>
                            <span class="price-highlight" id="monthly-phone">-</span>
                        </div>

                        <hr class="divider">

                        <h3 class="price-section-title">ì›” í†µì‹ ìš”ê¸ˆ</h3>
                        <div class="price-detail-row">
                            <span>ìš”ê¸ˆì œ</span>
                            <span id="base-plan-fee">-</span>
                        </div>
                        <div class="price-detail-row discount">
                            <span>ìš”ê¸ˆí• ì¸</span>
                            <span id="plan-discount">-</span>
                        </div>
                        <div class="price-detail-row discount">
                            <span>ê²°í•©í• ì¸</span>
                            <span id="bundle-discount">-</span>
                        </div>
                        <div class="price-result-row">
                            <span>ì›” í†µì‹ ìš”ê¸ˆ</span>
                            <span class="price-highlight" id="monthly-plan">-</span>
                        </div>

                        <hr class="divider">

                        <div class="price-total-row">
                            <span>ì›” ì˜ˆìƒ ë‚©ë¶€ ê¸ˆì•¡</span>
                            <span class="price-total" id="monthly-total">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ ìƒì„¸ ì„¹ì…˜ -->
            <div class="detail-sections" id="detail-sections">
                <!-- JSë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>
    </main>

    <!-- í•˜ë‹¨ ê³ ì • í‘¸í„° -->
    <div class="fixed-footer" id="fixed-footer">
        <div class="container">
            <div class="footer-price-summary">
                <div class="footer-price-item">
                    <span class="footer-label">ì›” íœ´ëŒ€í° ìš”ê¸ˆ</span>
                    <span class="footer-value" id="footer-monthly-phone">-</span>
                </div>
                <span class="footer-plus">+</span>
                <div class="footer-price-item">
                    <span class="footer-label">ì›” í†µì‹ ìš”ê¸ˆ</span>
                    <span class="footer-value" id="footer-monthly-plan">-</span>
                </div>
                <span class="footer-equals">=</span>
                <div class="footer-price-item total">
                    <span class="footer-label">ì›” ì˜ˆìƒ ë‚©ë¶€ ê¸ˆì•¡</span>
                    <span class="footer-value-total" id="footer-monthly-total">-</span>
                </div>
            </div>
            <div class="footer-actions">
                <button class="btn-consult">ìƒë‹´ì‹ ì²­</button>
                <button class="btn-order">ì£¼ë¬¸í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ í‘¸í„° -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <p>ê³ ê°ì„¼í„°: 1600-8939</p>
                    <p>ìƒë‹´ì‹œê°„: í‰ì¼ 09:00 - 18:00</p>
                </div>
                <div class="footer-legal">
                    <p>Â© 2025 SKT. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JS íŒŒì¼ ë¡œë“œ -->
    <script src="js/cloudinary.js"></script>
    <script src="js/api.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/common.js"></script>
    <script src="js/plans-modal.js"></script>
    
    <!-- ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * device-detail.html ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */

        // Cloudinary ì„¤ì •
        setCloudinaryConfig('tworld-store');

        // ì „ì—­ ë³€ìˆ˜
        let currentModel = '';
        let currentColor = '';
        let currentCapacity = 0;
        let currentPlan = null; // ëª¨ë‹¬ì—ì„œ ì„ íƒí•œ ìš”ê¸ˆì œ
        let allPlans = [];
        let devicesByCapacity = {};
        let galleryImages = {};

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * plans-modalê³¼ ì—°ë™ì„ ìœ„í•œ ì „ì—­ í•¨ìˆ˜
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        window.deviceDetailPage = {
            /**
             * ìš”ê¸ˆì œ í‘œì‹œ ì—…ë°ì´íŠ¸ (plans-modal.jsì—ì„œ í˜¸ì¶œ)
             */
            updatePlanDisplay: function(plan) {
                console.log('âœ… ìš”ê¸ˆì œ í‘œì‹œ ì—…ë°ì´íŠ¸:', plan);
                
                // ì„ íƒëœ ìš”ê¸ˆì œ ì €ì¥
                currentPlan = plan;
                
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                const displayEl = document.getElementById('selected-plan-display');
                if (displayEl) {
                    displayEl.textContent = plan.name;
                }
                
                // ì„ íƒëœ ìš”ê¸ˆì œ ì •ë³´ ë°•ìŠ¤ í‘œì‹œ
                const infoDiv = document.getElementById('selected-plan-info');
                if (infoDiv) {
                    infoDiv.classList.remove('hidden');
                }
                
                // ìš”ê¸ˆì œëª… í‘œì‹œ
                const planNameEl = document.getElementById('selected-plan-name');
                if (planNameEl) {
                    planNameEl.textContent = plan.name;
                }
                
                // ìš”ê¸ˆì œ ê°€ê²© í‘œì‹œ
                const planPriceEl = document.getElementById('selected-plan-price');
                if (planPriceEl) {
                    planPriceEl.textContent = formatPrice(plan.price) + '/ì›”';
                }
                
                // ê°€ê²© ì¬ê³„ì‚°
                updatePrice();
            }
        };

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * í˜ì´ì§€ ì´ˆê¸°í™”
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('ğŸš€ device-detail.html ë¡œë“œ ì‹œì‘');
                
                // â˜… Calculator ì´ˆê¸°í™” (settings ë¡œë“œ)
                await calculator.init();
                console.log('âœ… Calculator ì´ˆê¸°í™” ì™„ë£Œ');
                
                // URLì—ì„œ ëª¨ë¸ëª… ê°€ì ¸ì˜¤ê¸°
                const params = new URLSearchParams(window.location.search);
                currentModel = params.get('device');
                
                if (!currentModel) {
                    throw new Error('ëª¨ë¸ëª…ì´ ì—†ìŠµë‹ˆë‹¤');
                }
                
                console.log(`ğŸ“± ëª¨ë¸: ${currentModel}`);
                
                // ë°ì´í„° ë¡œë“œ
                await loadDetailPage();
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                setupEventListeners();
                
                console.log('âœ… device-detail.html ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ë°ì´í„° ë¡œë“œ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        async function loadDetailPage() {
            try {
                console.log('ğŸ“¦ ë°ì´í„° ë¡œë”© ì‹œì‘...');
                
                // 1. ëª¨ë“  ê¸°ê¸° ë°ì´í„° ë¡œë“œ
                const allDevices = await api.getDevices();
                
                // 2. í˜„ì¬ ëª¨ë¸ì˜ ëª¨ë“  ì˜µì…˜ í•„í„°ë§
                const deviceOptions = allDevices.filter(d => d.model === currentModel);
                
                if (deviceOptions.length === 0) {
                    throw new Error(`${currentModel} ê¸°ê¸° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
                
                console.log(`âœ… ${deviceOptions.length}ê°œ ì˜µì…˜ ë¡œë“œ`);
                
                // 3. ì²« ë²ˆì§¸ ìƒ‰ìƒ/ìš©ëŸ‰ ì„ íƒ
                currentColor = deviceOptions[0].color.name;
                currentCapacity = deviceOptions[0].storage;
                
                // 4. ìš©ëŸ‰ë³„ ê·¸ë£¹í™”
                devicesByCapacity = {};
                deviceOptions.forEach(device => {
                    const capacity = device.storage;
                    if (!devicesByCapacity[capacity]) {
                        devicesByCapacity[capacity] = [];
                    }
                    devicesByCapacity[capacity].push(device);
                });
                
                // 5. ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì¤€ë¹„ (placeholder ì‚¬ìš©)
                prepareGalleryImages(deviceOptions);
                
                // 6. ìš”ê¸ˆì œ ë¡œë“œ
                allPlans = await api.getAllPlans();
                console.log(`âœ… ${allPlans.length}ê°œ ìš”ê¸ˆì œ ë¡œë“œ`);
                
                // 7. UI ë Œë”ë§
                renderDeviceName(currentModel);
                renderColorOptions(deviceOptions);
                renderCapacityOptions();
                renderGallery(currentColor);
                renderDetailSections();
                
                // 8. ì´ˆê¸° ê°€ê²© ê³„ì‚°
                await updatePrice();
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ëª¨ë¸ëª… ë Œë”ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderDeviceName(title) {
            document.getElementById('device-name').textContent = title;
            document.title = `${title} - SKT ê³µì‹ ì˜¨ë¼ì¸ìƒµ`;
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ìƒ‰ìƒ ì˜µì…˜ ë Œë”ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderColorOptions(devices) {
            const container = document.getElementById('color-options');
            container.innerHTML = '';
            
            // ìƒ‰ìƒ ëª©ë¡ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
            const colors = [...new Set(devices.map(d => d.color.name))];
            
            colors.forEach((color, index) => {
                const btn = document.createElement('button');
                btn.className = 'color-btn' + (index === 0 ? ' active' : '');
                btn.textContent = color;
                btn.onclick = () => selectColor(color);
                container.appendChild(btn);
            });
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ìš©ëŸ‰ ì˜µì…˜ ë Œë”ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderCapacityOptions() {
            const container = document.getElementById('capacity-options');
            container.innerHTML = '';
            
            const capacities = Object.keys(devicesByCapacity).sort((a, b) => a - b);
            
            capacities.forEach((capacity, index) => {
                const btn = document.createElement('button');
                btn.className = 'capacity-btn' + (index === 0 ? ' active' : '');
                btn.textContent = `${capacity}GB`;
                btn.onclick = () => selectCapacity(parseInt(capacity));
                container.appendChild(btn);
            });
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì¤€ë¹„ (placeholder)
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function prepareGalleryImages(devices) {
            // ìƒ‰ìƒë³„ë¡œ ê·¸ë£¹í™”
            const colorGroups = {};
            devices.forEach(device => {
                const colorName = device.ìƒ‰ìƒëª…;
                if (!colorGroups[colorName]) {
                    colorGroups[colorName] = [];
                }
                colorGroups[colorName].push(device);
            });
            
            // ê° ìƒ‰ìƒë§ˆë‹¤ 4ê°œì˜ placeholder ì´ë¯¸ì§€ ìƒì„±
            galleryImages = {};
            Object.keys(colorGroups).forEach(colorName => {
                galleryImages[colorName] = [
                    `https://via.placeholder.com/600x600/cccccc/333333?text=${encodeURIComponent(colorName)}+ì •ë©´`,
                    `https://via.placeholder.com/600x600/cccccc/333333?text=${encodeURIComponent(colorName)}+í›„ë©´`,
                    `https://via.placeholder.com/600x600/cccccc/333333?text=${encodeURIComponent(colorName)}+ì¸¡ë©´`,
                    `https://via.placeholder.com/600x600/cccccc/333333?text=${encodeURIComponent(colorName)}+í™•ëŒ€`
                ];
            });
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê°¤ëŸ¬ë¦¬ ë Œë”ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderGallery(colorName) {
            const images = galleryImages[colorName];
            
            if (!images || images.length === 0) {
                console.warn(`ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì—†ìŒ: ${colorName}`);
                return;
            }
            
            // í° ì´ë¯¸ì§€ (ì²« ë²ˆì§¸)
            const mainImage = document.getElementById('main-image');
            mainImage.src = images[0];
            mainImage.alt = `${currentModel} ${colorName}`;
            
            // ì¸ë„¤ì¼ ê·¸ë¦¬ë“œ
            const thumbnailGrid = document.getElementById('thumbnail-grid');
            thumbnailGrid.innerHTML = '';
            
            images.forEach((imgUrl, index) => {
                const thumb = document.createElement('div');
                thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
                thumb.innerHTML = `<img src="${imgUrl}" alt="ì¸ë„¤ì¼ ${index + 1}">`;
                thumb.onclick = () => selectThumbnail(index, colorName);
                thumbnailGrid.appendChild(thumb);
            });
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ìƒì„¸ ì„¹ì…˜ ë Œë”ë§ (placeholder)
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderDetailSections() {
            const container = document.getElementById('detail-sections');
            container.innerHTML = `
                <div class="detail-section">
                    <img src="https://via.placeholder.com/860x400/f0f0f0/666666?text=í”„ë¡œëª¨ì…˜+ë°°ë„ˆ+1" 
                         alt="í”„ë¡œëª¨ì…˜ 1" 
                         loading="lazy">
                </div>
                <div class="detail-section">
                    <img src="https://via.placeholder.com/860x400/f0f0f0/666666?text=í”„ë¡œëª¨ì…˜+ë°°ë„ˆ+2" 
                         alt="í”„ë¡œëª¨ì…˜ 2" 
                         loading="lazy">
                </div>
                <div class="detail-section">
                    <img src="https://via.placeholder.com/860x600/f0f0f0/666666?text=ìƒì„¸+ìŠ¤í™+ì´ë¯¸ì§€" 
                         alt="ìƒì„¸ ìŠ¤í™" 
                         loading="lazy">
                </div>
            `;
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ì¸ë„¤ì¼ ì„ íƒ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function selectThumbnail(index, colorName) {
            const images = galleryImages[colorName];
            
            // í° ì´ë¯¸ì§€ ë³€ê²½
            const mainImage = document.getElementById('main-image');
            mainImage.src = images[index];
            
            // ì¸ë„¤ì¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                if (i === index) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ìƒ‰ìƒ ì„ íƒ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function selectColor(color) {
            currentColor = color;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.color-btn').forEach(btn => {
                if (btn.textContent === color) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ë³€ê²½
            renderGallery(color);
            
            // ê°€ê²© ì¬ê³„ì‚°
            updatePrice();
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ìš©ëŸ‰ ì„ íƒ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function selectCapacity(capacity) {
            currentCapacity = capacity;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.capacity-btn').forEach(btn => {
                if (btn.textContent === `${capacity}GB`) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // ê°€ê²© ì¬ê³„ì‚°
            updatePrice();
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê°€ê²© ì—…ë°ì´íŠ¸ (ë©”ì¸ í•¨ìˆ˜)
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        async function updatePrice() {
            try {
                // 1. í˜„ì¬ ì„ íƒëœ ì˜µì…˜ë“¤
                const joinType = document.getElementById('join-type-select').value;
                // âœ… ëª¨ë‹¬ì—ì„œ ì„ íƒí•œ ìš”ê¸ˆì œ ì‚¬ìš©
                const planId = currentPlan ? currentPlan.id : null;
                const discountType = document.querySelector('input[name="discount-type"]:checked').value;
                const internetTv = document.querySelector('input[name="internet-tv"]:checked').value;
                const installmentMonths = parseInt(document.querySelector('input[name="installment"]:checked').value);
                
                if (!planId) {
                    console.warn('ìš”ê¸ˆì œê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // 2. ê¸°ê¸° ë°ì´í„° ì¡°íšŒ (ëª¨ë¸ëª… + ìš©ëŸ‰ìœ¼ë¡œ ì°¾ê¸°)
                const allDevices = await api.getDevices();
                const device = allDevices.find(d => 
                    d.model === currentModel && 
                    d.storage === currentCapacity
                );
                
                // 3. ìš”ê¸ˆì œ ë° ì§€ì›ê¸ˆ ë°ì´í„° ë¡œë“œ
                const plan = await api.getPlan(planId);
                
                // ì§€ì›ê¸ˆ ì¡°íšŒë¥¼ ìœ„í•œ deviceId (ì²« ë²ˆì§¸ ë§¤ì¹­ ê¸°ê¸°ì˜ ID ì‚¬ìš©)
                const deviceId = device ? device.id : null;
                const subsidy = deviceId ? await api.getSubsidy(deviceId, planId, joinType) : null;
                
                if (!device || !plan || !subsidy) {
                    console.error('í•„ìš”í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // 4. ê°€ê²© ê³„ì‚°
                const result = calculator.calculate(device, plan, subsidy, {
                    discountType: discountType,
                    installmentMonths: installmentMonths,
                    internetTv: internetTv
                });
                
                // 5. UI ì—…ë°ì´íŠ¸
                displayPrice(result);
                
            } catch (error) {
                console.error('âŒ ê°€ê²© ê³„ì‚° ì‹¤íŒ¨:', error);
            }
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê°€ê²© í‘œì‹œ (9ê°œ í•­ëª©)
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function displayPrice(result) {
            // ì¶œê³ ê°€
            document.getElementById('release-price').textContent = formatPrice(result.releasePrice);
            
            // íœ´ëŒ€í° í• ì¸ê¸ˆ
            const phoneDiscount = result.subsidy.total;
            document.getElementById('phone-discount').textContent = formatDiscount(phoneDiscount);
            
            // í• ë¶€ì›ê¸ˆ
            document.getElementById('installment-principal').textContent = formatPrice(result.installmentPrincipal);
            
            // ì›” íœ´ëŒ€í° ìš”ê¸ˆ
            document.getElementById('monthly-phone').textContent = formatPrice(result.monthlyInstallment);
            
            // ìš”ê¸ˆì œ ê¸°ë³¸ë£Œ
            document.getElementById('base-plan-fee').textContent = formatPrice(result.basePlanFee);
            
            // ìš”ê¸ˆí• ì¸
            document.getElementById('plan-discount').textContent = formatDiscount(result.planDiscount);
            
            // ê²°í•©í• ì¸
            document.getElementById('bundle-discount').textContent = formatDiscount(result.bundleDiscount);
            
            // ì›” í†µì‹ ìš”ê¸ˆ
            document.getElementById('monthly-plan').textContent = formatPrice(result.monthlyPlanFee);
            
            // ì›” ì˜ˆìƒ ë‚©ë¶€ ê¸ˆì•¡
            document.getElementById('monthly-total').textContent = formatPrice(result.monthlyTotal);
            
            // í•˜ë‹¨ ê³ ì • í‘¸í„°ë„ ì—…ë°ì´íŠ¸
            document.getElementById('footer-monthly-phone').textContent = formatPrice(result.monthlyInstallment);
            document.getElementById('footer-monthly-plan').textContent = formatPrice(result.monthlyPlanFee);
            document.getElementById('footer-monthly-total').textContent = formatPrice(result.monthlyTotal);
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function setupEventListeners() {
            // ê°€ì…ìœ í˜• ë³€ê²½
            document.getElementById('join-type-select').addEventListener('change', updatePrice);
            
            // í• ì¸ë°©ë²• ë³€ê²½
            document.querySelectorAll('input[name="discount-type"]').forEach(radio => {
                radio.addEventListener('change', updatePrice);
            });
            
            // ì¸í„°ë„·+TV ë³€ê²½
            document.querySelectorAll('input[name="internet-tv"]').forEach(radio => {
                radio.addEventListener('change', updatePrice);
            });
            
            // í• ë¶€ê°œì›” ë³€ê²½
            document.querySelectorAll('input[name="installment"]').forEach(radio => {
                radio.addEventListener('change', updatePrice);
            });
            
            console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ì—ëŸ¬ í‘œì‹œ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function showError(message) {
            const container = document.getElementById('detail-container');
            container.innerHTML = `<div class="error-message">${message}</div>`;
        }
    </script>

    <!-- ìš”ê¸ˆì œ ì„ íƒ ëª¨ë‹¬ -->
    <div id="plans-modal" class="modal-overlay">
        <div class="modal-content">
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <div class="modal-header">
                <h2 class="text-2xl font-bold">ìš”ê¸ˆì œ ì„ íƒí•˜ê¸°</h2>
                <button onclick="plansModal.close()" class="close-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- ëª¨ë‹¬ ë°”ë”” -->
            <div class="modal-body">
                <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
                <div class="plan-categories mb-6">
                    <button class="plan-category-btn active" data-category="all">ì „ì²´</button>
                    <button class="plan-category-btn" data-category="5gx">5GX í”Œëœ</button>
                    <button class="plan-category-btn" data-category="5g-young">5G ì²­ì†Œë…„/ì–´ë¦°ì´</button>
                    <button class="plan-category-btn" data-category="senior">ì‹œë‹ˆì–´ ì „ìš©</button>
                    <button class="plan-category-btn" data-category="lte">Tí”Œëœ LTE</button>
                    <button class="plan-category-btn" data-category="prepaid">ì–´ë¦°ì´ ì „ìš© LTE</button>
                </div>

                <!-- ìš”ê¸ˆì œ ëª©ë¡ -->
                <div id="plans-list" class="plans-list">
                    <div class="text-center py-12">
                        <p class="text-gray-500">ìš”ê¸ˆì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>