<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <base href="/tworld-store-frontend/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ê¸° ì„ íƒ - SKT ê³µì‹ ì˜¨ë¼ì¸ìƒµ</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-text">í‹°ì›”ë“œìŠ¤í† ì–´</span>
                </a>
                <nav class="main-nav">
                    <a href="devices.html?brand=samsung">ì‚¼ì„±</a>
                    <a href="devices.html?brand=apple">ì• í”Œ</a>
                    <a href="devices.html">ì „ì²´ê¸°ê¸°</a>
                    <a href="plans.html">ìš”ê¸ˆì œ</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="devices-page">
        <div class="container">
            <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
            <div class="page-header">
                <h1 class="page-title">ê¸°ê¸° ì„ íƒ</h1>
            </div>

            <!-- ë¸Œëœë“œ í•„í„° ì„¹ì…˜ (sticky) -->
            <div class="filter-section">
                <div class="filter-bar">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-brand="all" onclick="filterByBrand('all')">
                            ì „ì²´
                        </button>
                        <button class="filter-btn" data-brand="samsung" onclick="filterByBrand('samsung')">
                            ì‚¼ì„±
                        </button>
                        <button class="filter-btn" data-brand="apple" onclick="filterByBrand('apple')">
                            ì• í”Œ
                        </button>
                        <button class="filter-btn" data-brand="lg" onclick="filterByBrand('lg')">
                            LG
                        </button>
                    </div>
                    <div class="filter-result">
                        <span id="result-count">0</span>ê°œ ê¸°ê¸°
                    </div>
                </div>
            </div>

            <!-- ê¸°ê¸° ëª©ë¡ ê·¸ë¦¬ë“œ -->
            <div class="devices-grid" id="devices-grid">
                <!-- JSë¡œ ë™ì  ìƒì„± -->
                <div class="loading-message">ê¸°ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>

            <!-- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ (ìˆ¨ê¹€) -->
            <div class="no-results" id="no-results" style="display: none;">
                <p>ì„ íƒí•˜ì‹  ë¸Œëœë“œì˜ ê¸°ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <p>ê³ ê°ì„¼í„°: 1600-8939</p>
                    <p>ìƒë‹´ì‹œê°„: í‰ì¼ 09:00 - 18:00</p>
                </div>
                <div class="footer-legal">
                    <p>Â© 2025 SKT. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JS íŒŒì¼ ë¡œë“œ -->
    <script src="js/cloudinary.js"></script>
    <script src="js/api.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/common.js"></script>

    <!-- ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * devices.html ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */

        // Cloudinary ì„¤ì •
        setCloudinaryConfig('tworld-store');

        // ì „ì—­ ë³€ìˆ˜
        let allDevices = [];
        let currentBrand = 'all';

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * í˜ì´ì§€ ì´ˆê¸°í™”
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('ğŸš€ devices.html ë¡œë“œ ì‹œì‘');
                
                // Calculator ì´ˆê¸°í™”
                await calculator.init();
                console.log('âœ… Calculator ì´ˆê¸°í™” ì™„ë£Œ');
                
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë¸Œëœë“œ ê°€ì ¸ì˜¤ê¸°
                const params = new URLSearchParams(window.location.search);
                const urlBrand = params.get('brand');
                if (urlBrand) {
                    currentBrand = urlBrand;
                }
                
                // ê¸°ê¸° ë°ì´í„° ë¡œë“œ
                await loadDevices();
                
                // URL ë¸Œëœë“œë¡œ í•„í„°ë§
                if (urlBrand) {
                    filterByBrand(urlBrand);
                } else {
                    renderDevices();
                }
                
                console.log('âœ… devices.html ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        });

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê¸°ê¸° ë°ì´í„° ë¡œë“œ
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        async function loadDevices() {
            try {
                console.log('ğŸ“¦ ê¸°ê¸° ë°ì´í„° ë¡œë”©...');
                
                // ì‹¤ì œ ë°ì´í„° ë¡œë“œ
                const devices = await api.getDevices();
                
                // ëª¨ë¸ë³„ë¡œ ê·¸ë£¹í™” (ê°™ì€ ëª¨ë¸ì˜ ì—¬ëŸ¬ ìƒ‰ìƒ/ìš©ëŸ‰ â†’ ëŒ€í‘œ 1ê°œë§Œ)
                const modelMap = new Map();
                
                devices.forEach(device => {
                    if (!modelMap.has(device.model)) {
                        // ê° ëª¨ë¸ì˜ ì²« ë²ˆì§¸ ê¸°ê¸°ë§Œ ì €ì¥
                        modelMap.set(device.model, {
                            model: device.model,
                            brand: device.brand,
                            price: Math.round(device.price / 24), // 24ê°œì›” í• ë¶€ ê°€ì •
                            subtitle: `${device.storage}GB Â· ${device.color.name}`,
                            storage: device.storage,
                            colorName: device.color.name
                        });
                    }
                });
                
                // Mapì„ ë°°ì—´ë¡œ ë³€í™˜
                allDevices = Array.from(modelMap.values());
                
                console.log(`âœ… ${allDevices.length}ê°œ ê¸°ê¸° ë¡œë“œ ì™„ë£Œ`);
                
            } catch (error) {
                console.error('âŒ ê¸°ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ê¸°ê¸° ë Œë”ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function renderDevices() {
            const container = document.getElementById('devices-grid');
            const noResults = document.getElementById('no-results');
            
            // ì˜ë¬¸ â†’ í•œê¸€ ë¸Œëœë“œëª… ë§¤í•‘
            const brandMap = {
                'samsung': 'ì‚¼ì„±',
                'apple': 'ì• í”Œ',
                'lg': 'LG'
            };
            
            // í˜„ì¬ ë¸Œëœë“œ í•„í„°ë§
            let filteredDevices = allDevices;
            if (currentBrand !== 'all') {
                const koreanBrand = brandMap[currentBrand];
                filteredDevices = allDevices.filter(d => d.brand === koreanBrand);
            }
            
            // ê²°ê³¼ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('result-count').textContent = filteredDevices.length;
            
            // ê²°ê³¼ ì—†ìŒ ì²˜ë¦¬
            if (filteredDevices.length === 0) {
                container.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            container.style.display = 'grid';
            noResults.style.display = 'none';
            
            // ì¹´ë“œ ìƒì„±
            container.innerHTML = '';
            filteredDevices.forEach(device => {
                const card = document.createElement('div');
                card.className = 'device-card';
                card.onclick = () => location.href = `device-detail.html?device=${encodeURIComponent(device.model)}`;
                
                // Placeholder ì´ë¯¸ì§€
                const imageUrl = `https://via.placeholder.com/400x400/cccccc/333333?text=${encodeURIComponent(device.model)}`;
                
                card.innerHTML = `
                    <div class="device-image">
                        <img src="${imageUrl}" 
                             alt="${device.model}"
                             loading="lazy">
                    </div>
                    <div class="device-info">
                        <h3 class="device-title">${device.model}</h3>
                        <p class="device-subtitle">${device.subtitle}</p>
                        <p class="device-price">ì›” ${formatPrice(device.price)}</p>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            console.log(`âœ… ${filteredDevices.length}ê°œ ê¸°ê¸° ë Œë”ë§ ì™„ë£Œ`);
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * ë¸Œëœë“œ í•„í„°ë§
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        function filterByBrand(brand) {
            console.log(`ğŸ” ë¸Œëœë“œ í•„í„°: ${brand}`);
            
            // ì˜ë¬¸ â†’ í•œê¸€ ë¸Œëœë“œëª… ë§¤í•‘
            const brandMap = {
                'samsung': 'ì‚¼ì„±',
                'apple': 'ì• í”Œ',
                'lg': 'LG',
                'all': 'all'
            };
            
            // í˜„ì¬ ë¸Œëœë“œ ì €ì¥ (ì˜ë¬¸)
            currentBrand = brand;
            
            // í•„í„° ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.brand === brand) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // URL ì—…ë°ì´íŠ¸ (íˆìŠ¤í† ë¦¬ì— ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
            const newUrl = brand === 'all' ? 'devices.html' : `devices.html?brand=${brand}`;
            window.history.replaceState({}, '', newUrl);
            
            // ê¸°ê¸° ì¬ë Œë”ë§
            renderDevices();
        }
    </script>
</body>
</html>