<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <base href="/tworld-store-frontend/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKT ê³µì‹ ì˜¨ë¼ì¸ìƒµ - ìµœì‹  ìŠ¤ë§ˆíŠ¸í°</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-text">í‹°ì›”ë“œìŠ¤í† ì–´</span>
                </a>
                <nav class="main-nav">
                    <a href="devices.html?brand=samsung">ì‚¼ì„±</a>
                    <a href="devices.html?brand=apple">ì• í”Œ</a>
                    <a href="devices.html">ì „ì²´ê¸°ê¸°</a>
                    <a href="plans.html">ìš”ê¸ˆì œ</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- íˆì–´ë¡œ ìŠ¬ë¼ì´ë” -->
    <section class="hero-section">
        <div class="hero-slider" id="hero-slider">
            <!-- JSë¡œ ë™ì  ìƒì„± -->
            <div class="slider-loading">
                <p>ë¡œë”© ì¤‘...</p>
            </div>
        </div>
        <div class="slider-dots" id="slider-dots">
            <!-- JSë¡œ ë™ì  ìƒì„± -->
        </div>
    </section>

    <!-- ì¸ê¸° ê¸°ê¸° ì„¹ì…˜ -->
    <section class="popular-section">
        <div class="container">
            <h2 class="section-title" id="popular-title">ìµœì‹  ìŠ¤ë§ˆíŠ¸í°</h2>
            <div class="devices-grid" id="popular-devices">
                <!-- JSë¡œ ë™ì  ìƒì„± -->
                <div class="loading-placeholder">
                    <p>ê¸°ê¸° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
            <div class="section-more">
                <a href="devices.html" class="btn-secondary">ì „ì²´ ê¸°ê¸° ë³´ê¸°</a>
            </div>
        </div>
    </section>

    <!-- ì¤‘ê°„ ë°°ë„ˆ -->
    <section class="middle-banner" id="middle-banner">
        <!-- JSë¡œ ë™ì  ìƒì„± -->
    </section>

    <!-- í”„ë¡œëª¨ì…˜ ì„¹ì…˜ -->
    <section class="promo-section" id="promo-section">
        <div class="container">
            <h2 class="section-title">íŠ¹ë³„ í˜œíƒ</h2>
            <div class="promo-grid" id="promo-grid">
                <!-- JSë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>
    </section>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <p>ê³ ê°ì„¼í„°: 1600-8939</p>
                    <p>ìƒë‹´ì‹œê°„: í‰ì¼ 09:00 - 18:00</p>
                </div>
                <div class="footer-legal">
                    <p>Â© 2025 SKT. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JS íŒŒì¼ ë¡œë“œ -->
    <script src="js/cloudinary.js"></script>
    <script src="js/api.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/common.js"></script>
    
    <!-- ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * index.html ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */

        // Cloudinary ì„¤ì •
        setCloudinaryConfig('tworld-store');

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * DOMContentLoaded ì´ë²¤íŠ¸
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('=== index.html ì´ˆê¸°í™” ì‹œì‘ ===');
                
                // 1. Calculator ì´ˆê¸°í™”
                await calculator.init();
                console.log('âœ… Calculator ì´ˆê¸°í™” ì™„ë£Œ');
                
                // 2. ë³‘ë ¬ë¡œ ëª¨ë“  ì„¹ì…˜ ë¡œë“œ
                await Promise.all([
                    renderHeroSlider(),
                    renderPopularDevices(),
                    renderMiddleBanner(),
                    renderPromoGrid()
                ]);
                
                console.log('=== index.html ì´ˆê¸°í™” ì™„ë£Œ ===');
            } catch (error) {
                console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        });

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * íˆì–´ë¡œ ìŠ¬ë¼ì´ë” ë Œë”ë§
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        async function renderHeroSlider() {
            const container = document.getElementById('hero-slider');
            
            // Placeholder ìŠ¬ë¼ì´ë” (3ê°œ)
            const slides = [
                { title: 'ê°¤ëŸ­ì‹œ S24 ì¶œì‹œ', link: 'device-detail.html?device=ê°¤ëŸ­ì‹œS24' },
                { title: 'ì•„ì´í° 16 Pro', link: 'device-detail.html?device=ì•„ì´í°16Pro' },
                { title: 'íŠ¹ë³„ í• ì¸ ì´ë²¤íŠ¸', link: 'devices.html' }
            ];
            
            container.innerHTML = slides.map((slide, index) => `
                <div class="hero-slide ${index === 0 ? 'active' : ''}" onclick="location.href='${slide.link}'">
                    <div class="hero-content">
                        <h1>${slide.title}</h1>
                        <p>ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                </div>
            `).join('');
            
            // ë„íŠ¸ ìƒì„±
            const dotsContainer = document.getElementById('slider-dots');
            dotsContainer.innerHTML = slides.map((_, index) => `
                <button class="dot ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></button>
            `).join('');
            
            // ìë™ ìŠ¬ë¼ì´ë“œ
            let currentSlide = 0;
            setInterval(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                goToSlide(currentSlide);
            }, 5000);
        }

        /**
         * ìŠ¬ë¼ì´ë“œ ì´ë™
         */
        function goToSlide(index) {
            const slides = document.querySelectorAll('.hero-slide');
            const dots = document.querySelectorAll('.dot');
            
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });
            
            dots.forEach((dot, i) => {
                if (i === index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * ì¸ê¸° ê¸°ê¸° ë Œë”ë§
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        async function renderPopularDevices() {
            const container = document.getElementById('popular-devices');
            
            try {
                // âœ… products.jsonì—ì„œ ì§ì ‘ ë¡œë“œ (ì˜ë¬¸ í•„ë“œëª…)
                const allDevices = await api.getDevices();
                
                // ëª¨ë¸ë³„ ê·¸ë£¹í™”
                const modelGroups = {};
                allDevices.forEach(device => {
                    const modelName = device.model;
                    if (!modelGroups[modelName]) {
                        modelGroups[modelName] = [];
                    }
                    modelGroups[modelName].push(device);
                });
                
                // ìµœëŒ€ 8ê°œ ëª¨ë¸ í‘œì‹œ
                const modelNames = Object.keys(modelGroups).slice(0, 8);
                
                // ê° ëª¨ë¸ë³„ ì¹´ë“œ ìƒì„±
                const cards = [];
                
                for (const modelName of modelNames) {
                    try {
                        const device = modelGroups[modelName][0]; // ì²« ë²ˆì§¸ ì˜µì…˜ ì‚¬ìš©
                        const deviceId = device.id;
                        
                        // ê¸°ë³¸ ìš”ê¸ˆì œ
                        const allPlans = await api.getPlans();
                        const plan = allPlans.find(p => p.category && p.category.name && p.category.name.includes('5G')) || allPlans[0];
                        
                        // ì§€ì›ê¸ˆ
                        const subsidy = await api.getSubsidy(deviceId, plan.id, 'change');
                        
                        if (!plan || !subsidy) continue;
                        
                        // ê°€ê²© ê³„ì‚°
                        const priceResult = calculator.calculate(
                            device,
                            plan,
                            subsidy,
                            {
                                discountType: 'subsidy',
                                installmentMonths: 24,
                                internetTv: 'none'
                            }
                        );
                        
                        // Placeholder ì¸ë„¤ì¼
                        const thumbnailUrl = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="400"%3E%3Crect width="400" height="400" fill="%23f3f4f6"/%3E%3Ctext x="50%25" y="50%25" font-size="16" fill="%23666" text-anchor="middle" dy=".3em"%3EğŸ“± ' + encodeURIComponent(modelName) + '%3C/text%3E%3C/svg%3E';
                        
                        cards.push({
                            modelName: modelName,
                            title: modelName,
                            subtitle: `${device.storage}GB Â· ${device.color.name}`,
                            thumbnailUrl: thumbnailUrl,
                            monthlyTotal: priceResult.monthlyTotal,
                            subsidyTotal: priceResult.subsidy.total,
                            releasePrice: priceResult.releasePrice
                        });
                        
                    } catch (error) {
                        console.error(`ì¹´ë“œ ìƒì„± ì‹¤íŒ¨: ${modelName}`, error);
                    }
                }
                
                // ë Œë”ë§
                container.innerHTML = cards.map(card => `
                    <div class="device-card" onclick="location.href='device-detail.html?device=${encodeURIComponent(card.modelName)}'">
                        <div class="device-image">
                            <img src="${card.thumbnailUrl}" alt="${card.title}">
                        </div>
                        <div class="device-info">
                            <h3 class="device-title">${card.title}</h3>
                            <p class="device-subtitle">${card.subtitle}</p>
                            <div class="device-pricing">
                                <div class="price-row">
                                    <span class="price-label">ì¶œê³ ê°€</span>
                                    <span class="price-value">${formatPrice(card.releasePrice)}ì›</span>
                                </div>
                                <div class="price-row">
                                    <span class="price-label">ì§€ì›ê¸ˆ</span>
                                    <span class="price-value discount">${formatPrice(card.subsidyTotal)}ì›</span>
                                </div>
                                <div class="price-row highlight">
                                    <span class="price-label">ì›” ë‚©ë¶€ê¸ˆ</span>
                                    <span class="price-value">${formatPrice(card.monthlyTotal)}ì›</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                console.log(`âœ… ì¸ê¸° ê¸°ê¸° ${cards.length}ê°œ ë Œë”ë§ ì™„ë£Œ`);
                
            } catch (error) {
                console.error('âŒ ì¸ê¸° ê¸°ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                container.innerHTML = '<div class="error-message"><p>ê¸°ê¸° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * ì¤‘ê°„ ë°°ë„ˆ ë Œë”ë§
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        async function renderMiddleBanner() {
            const container = document.getElementById('middle-banner');
            
            // Placeholder ë°°ë„ˆ
            container.innerHTML = `
                <div class="banner-item" onclick="location.href='devices.html'">
                    <div class="banner-content">
                        <h3>ê²¨ìš¸ íŠ¹ê°€ ì´ë²¤íŠ¸</h3>
                        <p>ìµœëŒ€ 30ë§Œì› í• ì¸</p>
                    </div>
                </div>
            `;
        }

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * í”„ë¡œëª¨ì…˜ ê·¸ë¦¬ë“œ ë Œë”ë§
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        async function renderPromoGrid() {
            const container = document.getElementById('promo-grid');
            
            // Placeholder í”„ë¡œëª¨ì…˜ (2x2 ê·¸ë¦¬ë“œ)
            const promos = [
                { title: '5G ìš”ê¸ˆì œ', link: 'plans.html' },
                { title: 'ì¸í„°ë„·+TV', link: 'plans.html' },
                { title: 'ì•¡ì„¸ì„œë¦¬', link: 'devices.html' },
                { title: 'ì´ë²¤íŠ¸', link: 'devices.html' }
            ];
            
            container.innerHTML = promos.map(promo => `
                <div class="promo-item" onclick="location.href='${promo.link}'">
                    <div class="promo-content">
                        <h4>${promo.title}</h4>
                    </div>
                </div>
            `).join('');
        }

        /**
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         * ê°€ê²© í¬ë§·íŒ… í—¬í¼
         * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         */
        function formatPrice(price) {
            return new Intl.NumberFormat('ko-KR').format(price);
        }
    </script>
</body>
</html>